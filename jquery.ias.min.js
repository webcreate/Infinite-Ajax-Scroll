/*!
 * Infinite Ajax Scroll, a jQuery plugin 
 * Version v0.1.5
 * http://webcreate.nl/
 *
 * Copyright (c) 2011-2012 Jeroen Fiege
 * Licensed under the MIT License: 
 * http://webcreate.nl/license
 */
(function(a){function b(a){if(window.console&&window.console.log)window.console.log(a)}a.ias=function(b){function i(){e.onChangePage(function(a,b,d){if(f)f.setPage(a,d);c.onPageChange.call(this,a,d,b)});j();if(f&&f.havePage()){l();pageNum=f.getPage();d.forceScrollTop(function(){if(pageNum>1){q(pageNum);curTreshold=n(true);a("html,body").scrollTop(curTreshold)}else{j()}})}return h}function j(){m();a(window).scroll(k)}function k(){scrTop=a(window).scrollTop();wndHeight=a(window).height();curScrOffset=scrTop+wndHeight;if(curScrOffset>=n()){o(curScrOffset)}}function l(){a(window).unbind("scroll",k)}function m(){a(c.pagination).hide()}function n(b){el=a(c.container).find(c.item).last();if(el.size()==0)return 0;treshold=el.offset().top+el.height();if(!b)treshold+=c.tresholdMargin;return treshold}function o(b,d){urlNextPage=a(c.next).attr("href");if(!urlNextPage)return l();e.pushPages(b,urlNextPage);l();s();p(urlNextPage,function(b,e){result=c.onLoadItems.call(this,e);if(result!==false){a(e).hide();curLastItem=a(c.container).find(c.item).last();curLastItem.after(e);a(e).fadeIn()}a(c.pagination).replaceWith(a(c.pagination,b));t();j();c.onRenderComplete.call(this,e);if(d)d.call(this)})}function p(b,d){var e=[];a.get(b,null,function(b){a(c.container,b).find(c.item).each(function(){e.push(this)});if(d)d.call(this,b,e)},"html")}function q(b){curTreshold=n(true);if(curTreshold>0){o(curTreshold,function(){l();if(e.getCurPageNum(curTreshold)+1<b){q(b);a("html,body").animate({scrollTop:curTreshold},400,"swing")}else{a("html,body").animate({scrollTop:curTreshold},1e3,"swing");j()}})}}function r(){loader=a(".ias_loader");if(loader.size()==0){loader=a("<div class='ias_loader'>"+c.loader+"</div>");loader.hide()}return loader}function s(b){loader=r();if(c.customLoaderProc!=="undefined"){c.customLoaderProc(loader)}else{el=a(c.container).find(c.item).last();el.after(loader)}loader.fadeIn()}function t(){loader=r();loader.remove()}var c=a.extend({},a.ias.defaults,b);var d=new a.ias.util;var e=new a.ias.paging;var f=c.history?new a.ias.history:false;var g=c.customLoaderProc||false;var h=this;i()};a.ias.defaults={container:"#container",item:".item",pagination:"#pagination",next:".next",loader:'<img src="images/loader.gif"/>',tresholdMargin:0,history:true,onPageChange:function(){},onLoadItems:function(){},onRenderComplete:function(){}};a.ias.util=function(){function e(){a(window).load(function(){b=true})}var b=false;var c=false;var d=this;e();this.forceScrollTop=function(e){a("html,body").scrollTop(0);if(!c){if(!b){setTimeout(function(){d.forceScrollTop(e)},1)}else{e.call();c=true}}}};a.ias.paging=function(){function e(){a(window).scroll(f)}function f(){scrTop=a(window).scrollTop();wndHeight=a(window).height();curScrOffset=scrTop+wndHeight;curPageNum=g(curScrOffset);curPagebreak=h(curScrOffset);if(d!=curPageNum){c.call(this,curPageNum,curPagebreak[0],curPagebreak[1])}d=curPageNum}function g(a){for(i=b.length-1;i>0;i--){if(a>b[i][0]){return i+1}}return 1}function h(a){for(i=b.length-1;i>=0;i--){if(a>b[i][0]){return b[i]}}return null}var b=[[0,document.location.toString()]];var c=function(){};var d=1;e();this.getCurPageNum=function(a){return g(a)};this.onChangePage=function(a){c=a};this.pushPages=function(a,c){b.push([a,c])}};a.ias.history=function(){function c(){b=!!(window.history&&history.pushState&&history.replaceState);b=false}var a=false;var b=false;c();this.setPage=function(a,b){this.updateState({page:a},"",b)};this.havePage=function(){return this.getState()!=false};this.getPage=function(){if(this.havePage()){stateObj=this.getState();return stateObj.page}return 1};this.getState=function(){if(b){stateObj=history.state;if(stateObj&&stateObj.ias)return stateObj.ias}else{haveState=window.location.hash.substring(0,7)=="#/page/";if(haveState){pageNum=parseInt(window.location.hash.replace("#/page/",""));return{page:pageNum}}}return false};this.updateState=function(b,c,d){if(a){this.replaceState(b,c,d)}else{this.pushState(b,c,d)}};this.pushState=function(c,d,e){if(b){history.pushState({ias:c},d,e)}else{hash=c.page>0?"#/page/"+c.page:"";window.location.hash=hash}a=true};this.replaceState=function(a,c,d){if(b){history.replaceState({ias:a},c,d)}else{this.pushState(a,c,d)}}}})(jQuery)